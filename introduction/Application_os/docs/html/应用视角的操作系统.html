<!DOCTYPE html>
<html lang="zh-Hans-CN"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=Edge"/><link rel="stylesheet" type="text/css" href="css/modern-norm.min.css"/><link rel="stylesheet" type="text/css" href="css/prism.min.css"/><link rel="stylesheet" type="text/css" href="css/katex.min.css"/><link rel="stylesheet" type="text/css" href="css/wolai.css"/><title>åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿ - wolai ç¬”è®°</title><link rel="shortcut icon" href="data:image/svg+xml,%3Csvg xmlns=&apos;http://www.w3.org/2000/svg&apos; viewBox=&apos;0 0 800 800&apos;%3E%3Cdefs%3E%3Cstyle%3E.cls-1%7Bfill:%23fff;%7D%3C/style%3E%3C/defs%3E%3Cg%3E%3Cpath class=&apos;cls-1&apos; d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Z&apos;/%3E%3Cpath d=&apos;M610.08,0c66,0,90,6.88,114.13,19.79a134.62,134.62,0,0,1,56,56l2.28,4.4C793.93,103,800,127.88,800,189.92V610.08l-.08,11.56c-.78,57.38-7.58,79.89-19.71,102.57a134.62,134.62,0,0,1-56,56l-4.4,2.28C697,793.93,672.12,800,610.08,800H189.92l-11.56-.08c-57.38-.78-79.89-7.58-102.57-19.71a134.62,134.62,0,0,1-56-56l-2.28-4.4C6.44,697.75.4,673.72,0,616L0,189.92c0-66,6.88-90,19.79-114.13a134.62,134.62,0,0,1,56-56l4.4-2.28C102.25,6.44,126.28.4,184,0Zm4.72,88.9H185.2L172.42,89c-32.78.62-43.68,3.24-54.71,9.14a45.84,45.84,0,0,0-19.54,19.54c-6.61,12.36-9.11,24.55-9.27,67.49V614.8L89,627.58c.62,32.78,3.24,43.68,9.14,54.71a45.84,45.84,0,0,0,19.54,19.54c12.36,6.61,24.55,9.11,67.49,9.27H610.08c46.79,0,59.41-2.44,72.21-9.28a45.84,45.84,0,0,0,19.54-19.54c6.61-12.36,9.11-24.55,9.27-67.49V189.92c0-46.79-2.44-59.41-9.28-72.21a45.84,45.84,0,0,0-19.54-19.54C669.93,91.56,657.74,89.06,614.8,88.9ZM233.33,493.33A73.34,73.34,0,1,1,160,566.67,73.35,73.35,0,0,1,233.33,493.33Z&apos;/%3E%3C/g%3E%3C/svg%3E"></link></head><body class="font-kai"><header><div class="image"></div><div class="title"><div class="banner"><div class="icon"></div></div><div data-title="åº”ç”¨è§†è§’çš„æ“ä½œç³»ç»Ÿ" class="main-title"></div></div></header><article><h2 id="9GrHgUBysmyAeguCbPkYHq" class="wolai-block"><span class="inline-wrap">æœ€å°çš„åº”ç”¨ç¨‹åº</span></h2><h3 id="7myAQVbmfEqJTnViLNWNx1" class="wolai-block"><span class="inline-wrap">å¤ä¹ ç›¸å…³å·¥å…·</span></h3><ol class="wolai-block"><li id="sx8T2Gp7PKGXuJJkpPizMC"><div class="marker"></div><span class="inline-wrap"><code>objdump -d</code></span><span class="inline-wrap">åæ±‡ç¼–</span></li><li id="kd96LMJH9nWcnZcUyf6oUY"><div class="marker"></div><span class="inline-wrap"><code>readelf -a</code></span><span class="inline-wrap">æŸ¥çœ‹æ‰€æœ‰çš„<span class="jill"></span>ELF<span class="jill"></span>ä¿¡æ¯</span></li><li id="4bGBBPW2tzxs3tRkm9KEXN"><div class="marker"></div><span class="inline-wrap"><code>--verbose</code></span><span class="inline-wrap">æŸ¥çœ‹æ‰€æœ‰çš„ç¼–è¯‘é€‰é¡¹ï¼Œ</span><span class="green inline-wrap"><u>å¯ä»¥çœ‹åˆ°åœ¨å“ªé‡Œæ‰¾å¤´æ–‡ä»¶</u></span><span class="inline-wrap"> </span><span class="inline-wrap"><code>gcc --verbose hello.c</code></span><code-block id="c2Th532onAHpT431kHHz2C" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"..."</span> <span class="token expression">search starts here<span class="token operator">:</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;...></span> <span class="token expression">search starts here<span class="token operator">:</span></span></span>
 <span class="token operator">/</span>usr<span class="token operator">/</span>lib<span class="token operator">/</span>gcc<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu<span class="token operator">/</span><span class="token number">11</span><span class="token operator">/</span>include
 <span class="token operator">/</span>usr<span class="token operator">/</span>local<span class="token operator">/</span>include
 <span class="token operator">/</span>usr<span class="token operator">/</span>include<span class="token operator">/</span>x86_64<span class="token operator">-</span>linux<span class="token operator">-</span>gnu
 <span class="token operator">/</span>usr<span class="token operator">/</span>include
End of search list<span class="token punctuation">.</span>
</pre></div></code-block></li><li id="pzz5ykSDQixNJHYzZRqp1E"><div class="marker"></div><span class="inline-wrap"><code>-WL,--verbose</code></span><span class="inline-wrap">æŸ¥çœ‹æ‰€æœ‰çš„é“¾æ¥é€‰é¡¹ï¼Œ</span><span class="green inline-wrap"><u>è§£é‡Šäº†<span class="jill"></span>end<span class="jill"></span>ç¬¦å·çš„ç”±æ¥</u></span><span class="inline-wrap"> </span><span class="inline-wrap"><code>gcc -Wl,--verbose hello.c</code></span><code-block id="fXtWz99wDAj5dWEydPQ7i6" class="wolai-block"><div class="wolai-pre"><div data-lang="6502 Assembly" class="marker"></div><pre><span class="token constant">OUTPUT_FORMAT</span><span class="token punctuation">(</span><span class="token string">"elf64-x86-64"</span><span class="token punctuation">,</span> <span class="token string">"elf64-x86-64"</span><span class="token punctuation">,</span>
        <span class="token string">"elf64-x86-64"</span><span class="token punctuation">)</span>
<span class="token constant">OUTPUT_ARCH</span><span class="token punctuation">(</span>i386<span class="token operator">:</span>x86<span class="token operator">-</span><span class="token number">64</span><span class="token punctuation">)</span>
<span class="token constant">ENTRY</span><span class="token punctuation">(</span>_start<span class="token punctuation">)</span>
_end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token constant">PROVIDE</span> <span class="token punctuation">(</span>end <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

</pre></div></code-block></li><li id="89MCHrB4hqHqMAFhRVw2G"><div class="marker"></div><span class="inline-wrap"><code>-static</code></span><span class="inline-wrap">ä¼šé™æ€é“¾æ¥<span class="jill"></span>libc<span class="jill"></span>åº“</span></li></ol><h3 id="nbgCAXdsKk28QVMMpi8Phy" class="wolai-block"><span class="inline-wrap">å°è¯•æ„å»ºæœ€å°çš„<span class="jill"></span>hello world</span></h3><ol class="wolai-block"><li id="jyvoUiK1A5342T8RfssgBM"><div class="marker"></div><span class="inline-wrap"><b>å»æ‰#include</b></span><span class="inline-wrap">ï¼šåæ±‡ç¼–è¡Œæ•°ä¸ä¹‹å‰å¹¶æ²¡æœ‰å‘ç”Ÿå˜åŒ–</span><div id="h2j1pWf6L2D8anwcMq87oC" class="wolai-block wolai-text"><div><span class="inline-wrap">é¢„å¤„ç†å™¨ä¼šå°†#include<span class="jill"></span>æ‰€å¼•ç”¨çš„å†…å®¹æ‹·è´åˆ°æ‰€åœ¨ä½ç½®</span></div></div></li><li id="5Qoo1CDwpF71kjj2kbfEJQ"><div class="marker"></div><span class="inline-wrap"><b>æ‰‹åŠ¨é“¾æ¥</b></span><span class="inline-wrap">ï¼šç¼–è¯‘å‡ºå¯é‡å®šå‘æ–‡ä»¶ï¼Œç„¶åä½¿ç”¨<span class="jill"></span>ld<span class="jill"></span>è¿›è¡Œ</span><span class="green inline-wrap"><b>é“¾æ¥ï¼ŒæŠ¥é”™å¦‚ä¸‹</b></span><span class="inline-wrap">ï¼š</span><code-block id="9Wedu2tXzPJFJVZdSxtY4j" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>ld<span class="token operator">:</span> è­¦å‘Š<span class="token operator">:</span> æ— æ³•æ‰¾åˆ°é¡¹ç›®ç¬¦å· _start<span class="token punctuation">;</span> ç¼ºçœä¸º <span class="token number">0000000000401000</span>
ld<span class="token operator">:</span> hello<span class="token punctuation">.</span>o<span class="token operator">:</span> in function `main'<span class="token operator">:</span>
hello<span class="token punctuation">.</span>c<span class="token operator">:</span><span class="token punctuation">(</span><span class="token punctuation">.</span>text<span class="token operator">+</span><span class="token number">0x13</span><span class="token punctuation">)</span><span class="token operator">:</span> undefined reference to `puts'
</pre></div></code-block><div id="skfet1CSGSU3vFCUtmHhah" class="wolai-block wolai-text"><div><span class="inline-wrap">å› ä¸ºï¼Œåœ¨<span class="jill"></span>objdump<span class="jill"></span>åæ±‡ç¼–ä¸­ï¼Œå¯é‡å®šå‘æ–‡ä»¶çš„<span class="jill"></span>call<span class="jill"></span>å¹¶ä¸çŸ¥é“è¦è·³è½¬åˆ°å“ªé‡Œ</span></div></div><div id="sAkYkRQEdbRu9hExC8mdm" class="wolai-block"><figure class="wolai-left" style="width: 705.6px; flex-direction: column"><img src="media/image.png" style="width: 100%"/></figure></div></li><li id="5khnEVLURjLjFobAmMax6A"><div class="marker"></div><span class="inline-wrap"><b>å»æ‰<span class="jill"></span>printfï¼Œå†è¿›è¡Œæ‰‹åŠ¨é“¾æ¥</b></span><span class="inline-wrap">ï¼šé“¾æ¥æˆåŠŸä½†æ˜¯æ‰§è¡Œå¤±è´¥</span><div id="6QnxRUodorueHpQdFhSPxz" class="wolai-block"><figure class="wolai-left" style="width: 100%; flex-direction: column"><img src="media/image_1.png" style="width: 100%"/></figure></div><div id="mmRHQyum5Zd7HCH6uWR6Gz" class="wolai-block wolai-text"><div><span class="inline-wrap">å¯ä»¥å‘ç°æ˜¯</span><span class="green inline-wrap"><u>ret<span class="jill"></span>åœ¨è¿”å›æ—¶</u></span><span class="inline-wrap"></span><span class="green inline-wrap"><u>ï¼Œç›´æ¥è¿”å›åˆ°äº†<span class="jill"></span>0x1<span class="jill"></span>å¤„ï¼Œæ˜¯ç¨‹åºæ— æ³•è®¿é—®çš„å†…å­˜ã€‚ç„¶åå‘ç”Ÿäº†æ®µé”™è¯¯</u></span></div></div><div id="aiaqLqUXG5dzZgLxHkUn9d" class="wolai-block"><figure class="wolai-left" style="width: 481.6px; flex-direction: column"><img src="media/image_2.png" style="width: 100%"/></figure></div><ol class="wolai-block"><li id="geiCm51UkaSswt8uazNoeU"><div class="marker"></div><span class="inline-wrap"><code>p</code></span><span class="inline-wrap">å‘½ä»¤ æŸ¥çœ‹å¯„å­˜å™¨ä¿¡æ¯</span></li><li id="fKh5eAyx9Rk9tAXZ5BFpJP"><div class="marker"></div><span class="inline-wrap"><code>x/x </code></span><span class="inline-wrap">åœ°å€è®¿å­˜</span></li></ol></li><li id="6AxrJEJjppUfPtrLjBkaGz"><div class="marker"></div><span class="inline-wrap"><b>åŠ å…¥<span class="jill"></span>while(1)</b></span><span class="inline-wrap">ï¼šæ­£ç¡®æ‰§è¡Œï¼Œä½†æ˜¯ä¸èƒ½é€€å‡º</span><div id="k6KSYnmUubHsuLx4uYxuGa" class="wolai-block wolai-text"><div><span class="green inline-wrap"><b>ç¨‹åºçš„é€€å‡ºæ˜¯éœ€è¦ä½¿ç”¨<span class="jill"></span>Sys_exit<span class="jill"></span>ç³»ç»Ÿè°ƒç”¨æ¥è¿›è¡Œ</b></span></div></div><div id="twr7ZVbrKVLvSPxrCXNxrq" class="wolai-block wolai-text"><div><span class="green inline-wrap"><b>å¤„ç†å™¨è¿™ä¸ªçŠ¶æ€æœºåªä¼šæ— æƒ…çš„æŒ‰ç…§<span class="jill"></span>pc<span class="jill"></span>æ‰§è¡ŒæŒ‡ä»¤ï¼Œä½†æ˜¯æŒ‡ä»¤é›†ä¸­æ²¡æœ‰è§„å®šé€€å‡ºç¨‹åº/å…³é—­è®¡ç®—æœºçš„æŒ‡ä»¤ï¼Œå› æ­¤ç¨‹åºä¸­ä¹Ÿæ²¡æœ‰ä¸€æ¡é€€å‡ºç¨‹åºçš„æŒ‡ä»¤ã€‚é€€å‡ºã€æ‰“å°ç­‰ç›¸åº”å·¥ä½œçš„è¿›è¡Œéƒ½æ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨ï¼Œå‘é€ç»™æ“ä½œç³»ç»Ÿæ¥è¿›è¡Œ</b></span><span class="inline-wrap">â†’</span><span class="blue inline-wrap"><b>æ“ä½œç³»ç»Ÿå¯ä»¥ä»»æ„æ”¹å˜ç¨‹åºçŠ¶æ€</b></span></div></div><blockquote id="hgfpvPQv78peDvM94kCvE7" class="wolai-block"><span class="inline-wrap"><b>å…³é—­è®¡ç®—æœºæ˜¯æ€ä¹ˆè¿›è¡Œçš„ï¼Ÿ</b></span><div id="679AD7AP6qjDK9QZ3itfuQ" class="wolai-block"><figure class="wolai-left" style="width: 676.8px; flex-direction: column"><img src="media/image_3.png" style="width: 100%"/></figure></div></blockquote></li><li id="cjJuXQZKVYuXmVztVYYqjp"><div class="marker"></div><span class="inline-wrap">ä½¿ç”¨æ±‡ç¼–è¯­è¨€ç¼–å†™æœ€å°çš„<span class="jill"></span>hello world<span class="jill"></span>ç¨‹åº</span><div id="8XrJCdJtGKAWyDFb8kKi9a" class="wolai-block wolai-text"><div><span class="inline-wrap">C<span class="jill"></span>è¯­è¨€å°±å¯ä»¥é€šè¿‡</span><span class="inline-wrap"><code>sys/syscall.h</code></span><span class="inline-wrap">ä¸­çš„</span><span class="inline-wrap"><code>syscall(long number,...)</code></span><span class="inline-wrap">å‡½æ•°è°ƒç”¨ç³»ç»Ÿè°ƒç”¨</span></div></div><code-block id="bjqg77iTba1dvgrTsDixsp" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/syscall.h></span></span>

<span class="token comment">// The x86-64 system call Application Binary Interface (ABI):</span>
<span class="token comment">//     System call number: RAX</span>
<span class="token comment">//     Arguments: RDI, RSI, RDX, RCX, R8, R9</span>
<span class="token comment">//     Return value: RAX</span>
<span class="token comment">// See also: syscall(2) syscalls(2)</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">syscall3</span><span class="token expression"><span class="token punctuation">(</span>id<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> a3<span class="token punctuation">)</span> </span><span class="token punctuation">\</span>
    <span class="token expression">movq $SYS_</span><span class="token punctuation">##</span><span class="token expression">id<span class="token punctuation">,</span> <span class="token operator">%</span>rax<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
    <span class="token expression">movq $a1<span class="token punctuation">,</span> <span class="token operator">%</span>rdi<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
    <span class="token expression">movq $a2<span class="token punctuation">,</span> <span class="token operator">%</span>rsi<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
    <span class="token expression">movq $a3<span class="token punctuation">,</span> <span class="token operator">%</span>rdx<span class="token punctuation">;</span> </span><span class="token punctuation">\</span>
    <span class="token expression">syscall</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">syscall2</span><span class="token expression"><span class="token punctuation">(</span>id<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">)</span>  <span class="token function">syscall3</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> a2<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">syscall1</span><span class="token expression"><span class="token punctuation">(</span>id<span class="token punctuation">,</span> a1<span class="token punctuation">)</span>  <span class="token function">syscall2</span><span class="token punctuation">(</span>id<span class="token punctuation">,</span> a1<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span></span></span>

<span class="token punctuation">.</span>globl _start
_start<span class="token operator">:</span>
    <span class="token function">syscall3</span><span class="token punctuation">(</span>write<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> addr1<span class="token punctuation">,</span> addr2 <span class="token operator">-</span> addr1<span class="token punctuation">)</span> <span class="token comment">//è°ƒç”¨sys_writeç³»ç»Ÿè°ƒç”¨ã€€å†™addr1èµ·å§‹çš„(addr2-addr1)å¤§å°çš„æ•°æ®</span>
    <span class="token function">syscall1</span><span class="token punctuation">(</span>exit<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">//è°ƒç”¨sys_exité€€å‡ºç¨‹åº</span>

addr1<span class="token operator">:</span>
    <span class="token punctuation">.</span>ascii <span class="token string">"\033[01;31mHello, OS World\033[0m\n"</span> <span class="token comment">//é‡ç½®ï¼ˆæ¶ˆé™¤ï¼‰æ‰€æœ‰é¢œè‰²å’Œå›¾å½¢ï¼Œç„¶ååŠ ç²—è®¾ç½®çº¢è‰²</span>
addr2<span class="token operator">:</span>
</pre></div></code-block></li></ol><h3 id="NMfpTwfUrg1uvudnrYTmU" class="wolai-block"><span class="inline-wrap">ä½¿ç”¨<span class="jill"></span>strace<span class="jill"></span>è¿½è¸ªç³»ç»Ÿè°ƒç”¨</span></h3><ol class="wolai-block"><li id="a8pEQxvGBz3GVbEbjtYQPx"><div class="marker"></div><span class="inline-wrap">æ“ä½œç³»ç»Ÿä¸Šçš„åº”ç”¨ç¨‹åºå±‚æ¬¡</span><div id="dTFiP73ufXERfS4AX6J5JA" class="wolai-block wolai-text"><div><span class="green inline-wrap">Coreutilsï¼ˆUbuntu<span class="jill"></span>ä½¿ç”¨çš„æ˜¯<span class="jill"></span>GNU Coreutilsï¼‰â†’ç³»ç»Ÿå‘½ä»¤<span class="jill"></span>sshã€vimã€ffmpeg<span class="jill"></span>ç­‰â†’VScodeã€å‰ªè¾‘è½¯ä»¶</span></div></div><ul class="wolai-block"><li id="gthyKjoVEcb4yupRC3T64L"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">BusyBoxï¼ˆPA<span class="jill"></span>ä¸­ä½¿ç”¨çš„ï¼‰</span></li><li id="ve5v1DkiK2tbb4QqpVPQ2m"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">Toybox</span><code-block id="8E6AYZoFKHKjuEUEcmaysq" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">wget</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-np</span> <span class="token parameter variable">-nH</span> --cut-dirs<span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">-R</span> <span class="token string">"index.html*"</span> <span class="token string">"https://jyywiki.cn/os-demos/introduction/tar/"</span> --no-check-certificate
</pre></div></code-block><div id="5GrNtNyBiK5v6yaxJx5Puv" class="wolai-block wolai-text"><div><span class="inline-wrap">ä¹‹åè§£å‹</span><span class="inline-wrap"><code>toybox-0.1.0-tar.bz2</code></span><span class="inline-wrap">ï¼Œè¿›å…¥<span class="jill"></span>toybox-0.1.0<span class="jill"></span>å†…<span class="jill"></span>make<span class="jill"></span>å³å¯</span></div></div><div id="eveKaBTzeNFBfXVoNRPEHR" class="wolai-block wolai-text"><div><span class="inline-wrap">make<span class="jill"></span>æ—¶ä¼šæŠ¥é”™</span><span class="inline-wrap"><code>toys/mdev.c</code></span><span class="inline-wrap">å†…</span><span class="green inline-wrap"><u>â€œundefined reference to `makedevâ€™â€</u></span><span class="inline-wrap">ï¼Œåœ¨</span><span class="inline-wrap"><code>toys/mdev.c</code></span><span class="inline-wrap">å†…æ·»åŠ å¤´æ–‡ä»¶</span><span class="inline-wrap"><code>#include &lt;sys/sysmacros.h&gt;</code></span><span class="inline-wrap">é‡æ–°ç¼–è¯‘å³å¯</span></div></div></li></ul></li><li id="35dQHG2ktPPmgm5vtTtaN5"><div class="marker"></div><span class="inline-wrap">è¿™äº›ç¨‹åºéƒ½æ˜¯å¯æ‰§è¡Œæ–‡ä»¶ï¼Œå’Œ<span class="jill"></span>minimal.S<span class="jill"></span>çš„å¯æ‰§è¡Œæ–‡ä»¶æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«</span><div id="jLJRFYhtRqng8Xc4urQkpa" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>å¯ä»¥åœ¨<span class="jill"></span>VSCode<span class="jill"></span>ä¸­å®‰è£…</u></span><span class="green inline-wrap"><u><code>Hex Editor</code></u></span><span class="green inline-wrap"><u>æ’ä»¶æ¥æŸ¥çœ‹å¹¶æ›´æ”¹äºŒè¿›åˆ¶æ–‡ä»¶</u></span></div></div></li><li id="5BbxZucUVPQMViGRb8Adcu"><div class="marker"></div><span class="inline-wrap">ä½¿ç”¨<span class="jill"></span>strace<span class="jill"></span>è¿½è¸ªåº”ç”¨ç¨‹åºçš„ç³»ç»Ÿè°ƒç”¨</span><div id="9muqVVPn9QoTP7WDb4NMYy" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>strace -f è¿›ç¨‹</code></span><span class="inline-wrap">è¿½è¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨ï¼ŒåŒ…æ‹¬å­è¿›ç¨‹</span></div><div id="tSFuR7QFjU1egVGS9iQVK5" class="wolai-block wolai-text"><div><span class="inline-wrap">å¯ä»¥ç®¡é“ç»™<span class="jill"></span>vim<span class="jill"></span>æŸ¥çœ‹</span><span class="inline-wrap"><code>|&amp;</code></span><span class="inline-wrap"></span><span class="inline-wrap"><code> vim-</code></span><span class="inline-wrap">ï¼Œåœ¨ç¼–è¾‘å™¨ä¸­ä½¿ç”¨</span><span class="inline-wrap"><code>%!grep -v -e -1</code></span><span class="inline-wrap"></span><span class="inline-wrap">å»æ‰éæ³•çš„ç³»ç»Ÿè°ƒç”¨</span></div></div></div><code-block id="d1sD61XXUYGkPs8uoKJz5v" class="wolai-block"><div class="wolai-pre"><div data-lang="Bash" class="marker"></div><pre><span class="token function">wget</span> <span class="token parameter variable">-r</span> <span class="token parameter variable">-np</span> <span class="token parameter variable">-nH</span> --cut-dirs<span class="token operator">=</span><span class="token number">2</span> <span class="token parameter variable">-R</span> <span class="token string">"index.html*"</span> <span class="token string">"https://jyywiki.cn/os-demos/introduction/strace/"</span> --no-check-certificate</pre></div></code-block><div id="8JTGwTX6pWAUVEBPspavrz" class="wolai-block wolai-text"><div><span class="inline-wrap">é€šè¿‡</span><span class="inline-wrap"><code>make gcc-demo |&amp; vim-</code></span><span class="inline-wrap">å¯ä»¥çœ‹åˆ°<span class="jill"></span>gcc<span class="jill"></span>ä½¿ç”¨<span class="jill"></span>SYS_execve<span class="jill"></span>ç³»ç»Ÿè°ƒç”¨ï¼Œè°ƒç”¨äº†å¤–éƒ¨çš„<span class="jill"></span>as<span class="jill"></span>å’Œ<span class="jill"></span>ld<span class="jill"></span>æ¥è¿›è¡Œæ±‡ç¼–å’Œé“¾æ¥</span></div></div><div id="6SnNJ9wo4thqTccABkLoeq" class="wolai-block"><figure class="wolai-left" style="width: 100%; flex-direction: column"><img src="media/image_4.png" style="width: 100%"/></figure></div><div id="kRWhyEK1j2Aq7bc2Qj4C7u" class="wolai-block"><figure class="wolai-left" style="width: 100%; flex-direction: column"><img src="media/image_5.png" style="width: 100%"/></figure></div><div id="vs6bkgCnjRVLPioYemVevh" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>é€šè¿‡<span class="jill"></span>make xedit-demo<span class="jill"></span>çŸ¥é“äº†ç»˜åˆ¶ä¹Ÿæ˜¯é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿›è¡Œçš„ï¼Œwrite<span class="jill"></span>æ˜¾ç¤ºç¼“å†²åŒº read<span class="jill"></span>é”®ç›˜<span class="jill"></span>read<span class="jill"></span>å…‰æ ‡</u></span></div></div></li></ol><h2 id="dcyDqa3RKmMzMBEBzBvHSk" class="wolai-block"><span class="inline-wrap">ç†è§£é«˜çº§è¯­è¨€ç¨‹åº</span></h2><h3 id="6maByzDsUYN9KAMLVwd5CL" class="wolai-block"><span class="inline-wrap">Simple C<span class="jill"></span>è§£é‡Šå™¨</span></h3><div id="veTxBsLMMdG7HdCG3q2FjN" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>Simple C<span class="jill"></span>çš„æ¯ä¸€æ¡è¯­å¥éƒ½è‡³å¤šåšä¸€æ¬¡è¿ç®—ï¼Œä¸”æ¡ä»¶è¯­å¥ä¸­ä¸åŒ…å«è¿ç®—</u></span></div></div><div id="giepgoeZqAoMP6EsxrM16s" class="wolai-block wolai-text"><div><span class="inline-wrap">å¯ä»¥æ„å»ºçŠ¶æ€æœºä¸ºï¼š</span></div></div><div id="wkcBaZVj8WGHb97HYxTc5n" class="wolai-row"><div id="5S4CCCNAcNLvu7qsNbq6Rw" class="wolai-col" style="flex-grow: 0.5"><div id="9TZZ3pWiZLzpBatvY95MTU" class="wolai-block"><figure class="wolai-left" style="width: 626px; flex-direction: column"><img src="media/image_6.png" style="width: 100%"/></figure></div></div><div id="kXuyZVJTC7Lva2pQtKPvSn" class="wolai-col" style="flex-grow: 0.5"><ul class="wolai-block"><li id="rW4kZP6XHaLu4MpbSiAhuM"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">çŠ¶æ€æ˜¯æ ˆå¸§çš„é›†åˆ<span class="jill"></span>+<span class="jill"></span>å…¨å±€å˜é‡ï¼Œæ¯ä¸€ä¸ªæ ˆå¸§ä¸­å­˜å‚¨ç€è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œå‚æ•°</span><span class="inline-wrap"><b>ä»¥åŠæ‰§è¡Œåˆ°çš„<span class="jill"></span>PC<span class="jill"></span>å€¼</b></span><div id="cLxvQub73KajVZxHqgVGxb" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>æœ‰äº†<span class="jill"></span>PCï¼Œè¿™æ ·ä»å‡½æ•°è¿”å›æ—¶ï¼Œæ‰çŸ¥é“ä»å“ªç»§ç»­æ‰§è¡Œ</u></span></div></div></li><li id="9FV6Y6NDqSaEoAZQrDNUYv"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">åˆå§‹çŠ¶æ€ï¼šæ ˆå¸§é›†åˆä¸­åªæœ‰ä¸€ä¸ªæ ˆå¸§ï¼Œå³ä¸º<span class="jill"></span>main<span class="jill"></span>çš„æ ˆå¸§ï¼ŒPC<span class="jill"></span>ä¸º<span class="jill"></span>0ï¼›å…¨å±€å˜é‡ä¸ºåˆå§‹å€¼</span></li><li id="d3EwvQBFhQfNyWrL9fHriz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">çŠ¶æ€è¿ç§»</span><span class="green inline-wrap"><u>ï¼šæ‰§è¡Œæ ˆé¡¶æ ˆå¸§çš„<span class="jill"></span>PC<span class="jill"></span>å¤„è¯­å¥</u></span></li></ul></div></div><div id="srLaLtuW7suVczmUySLVGB" class="wolai-block wolai-text"><div><span class="inline-wrap">ä¸‹é¢ä»¥æ±‰è¯ºå¡”ä¸ºä¾‹ï¼Œæ„å»º<span class="jill"></span>Simple C<span class="jill"></span>çŠ¶æ€æœºï¼š</span></div><ul class="wolai-block"><li id="8XmKyfjwxtxbx57RW18LFY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ä¸ä½¿ç”¨çŠ¶æ€æœºçš„æ±‰è¯ºå¡”å®ç°</span><div id="qqSBZQk7KfL9ATWYoQSsq3" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>å°†<span class="jill"></span>n<span class="jill"></span>ä¸ªç›˜å­ä»<span class="jill"></span>A<span class="jill"></span>ç»<span class="jill"></span>B<span class="jill"></span>ç§»åˆ°<span class="jill"></span>Cï¼Œå¯ä»¥å…ˆå°†<span class="jill"></span>n-1<span class="jill"></span>ä¸ªç›˜å­ç§»åˆ°<span class="jill"></span>Bï¼Œå†æŠŠæœ€åçš„ä¸€ä¸ªç›˜å­ç§»åˆ°<span class="jill"></span>Cï¼Œä¹‹åå†å°†<span class="jill"></span>n-1<span class="jill"></span>ä¸ª<span class="jill"></span>B<span class="jill"></span>ä¸Šçš„ç›˜å­ç»<span class="jill"></span>A<span class="jill"></span>ç§»åˆ°<span class="jill"></span>C</u></span></div></div><code-block id="8GsGEKeCtyJvg5PdA1HXDk" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h></span></span>

<span class="token keyword">int</span> <span class="token function">hanoi</span><span class="token punctuation">(</span><span class="token keyword">int</span> n<span class="token punctuation">,</span> <span class="token keyword">char</span> from<span class="token punctuation">,</span> <span class="token keyword">char</span> to<span class="token punctuation">,</span> <span class="token keyword">char</span> via<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c -> %c\n"</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//åªæœ‰ä¸€ä¸ªç›˜å­ï¼ŒæŠŠå®ƒä»fromç§»åˆ°to</span>
        <span class="token keyword">return</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token keyword">int</span> c1 <span class="token operator">=</span> <span class="token function">hanoi</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> via<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//å…ˆæŠŠn-1ä¸ªç›˜å­ç§»åˆ°ä¸­é—´</span>
        <span class="token function">hanoi</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//ç„¶åæŠŠï¼‘ä¸ªç›˜å­ç§»åˆ°to</span>
        <span class="token keyword">int</span> c2 <span class="token operator">=</span> <span class="token function">hanoi</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> via<span class="token punctuation">,</span> to<span class="token punctuation">,</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//æœ€åå†æŠŠn-1ä¸ªåœ¨ä¸­é—´çš„ç›˜å­ç§»åˆ°to</span>
        <span class="token keyword">return</span> c1 <span class="token operator">+</span> c2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</pre></div></code-block></li><li id="hSLfzR6NT5Kc7AJvoojLkK"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">ä½¿ç”¨çŠ¶æ€æœºçš„æ±‰è¯ºå¡”å®ç°</span><ul class="wolai-block"><li id="cReMMqgzURPkrguPtU5akU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">å®šä¹‰æ ˆå¸§ç»“æ„ä½“</span><code-block id="nDL6VCuiippoprqGYwudcD" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">struct</span> <span class="token class-name">Frame</span> <span class="token punctuation">{</span>
    <span class="token comment">// Each frame has a program counter to keep track its next</span>
    <span class="token comment">// to-be-executed statement.</span>
    <span class="token keyword">int</span> pc<span class="token punctuation">;</span>

    <span class="token comment">// The internal state of the frame. This state includes</span>
    <span class="token comment">// both arguments and local variables (if any).</span>
    <span class="token comment">//</span>
    <span class="token comment">// Arguments:</span>
    <span class="token comment">// æŒ‰ç…§é€’å½’å®ç°çš„æ±‰è¯ºå¡”ï¼Œå‡½æ•°çš„å‚æ•°æœ‰n from to via</span>
    <span class="token comment">// å‡½æ•°å†…éƒ¨ä½¿ç”¨çš„å±€éƒ¨å˜é‡åŒ…æ‹¬c1,c2</span>
    <span class="token keyword">int</span> n<span class="token punctuation">;</span>
    <span class="token keyword">char</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">;</span>

    <span class="token comment">// Local variables:</span>
    <span class="token keyword">int</span> c1<span class="token punctuation">,</span> c2<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</pre></div></code-block></li><li id="taghAarwLBo89rjGBSgkAi"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">å®šä¹‰æ ˆå¸§é›†åˆä»¥åŠæ ˆé¡¶æŒ‡é’ˆ</span><code-block id="xskH7ZwaTHtWKtKX9xQXJS" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>Frame stk<span class="token punctuation">[</span><span class="token number">64</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//æ ˆå¸§é›†åˆ</span>
Frame <span class="token operator">*</span>top <span class="token operator">=</span> stk <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">//topæŒ‡å‘æ ˆé¡¶ï¼Œæ²¡æœ‰å…ƒç´ æ—¶å®šä¹‰ä¸ºæ ˆèµ·å§‹-æ ˆå¸§å¤§å°</span></pre></div></code-block></li><li id="3VivUcFomD2zNWcUfadkio"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">å®šä¹‰å®ï¼Œå®ç°å‡½æ•°è°ƒç”¨å’Œå‡½æ•°è¿”å›</span><code-block id="FGoB7cqipuehcENmzTcpD" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>    <span class="token comment">// Function call: push a new frame (PC=0) onto the stack</span>
    <span class="token comment">// è°ƒç”¨å‡½æ•°ï¼Œç›¸å½“äºæ–°å…¥æ ˆä¸€ä¸ªæ ˆå¸§ï¼Œå› ä¸ºæ ˆèµ·å§‹å®šä¹‰ä¸ºstk-1</span>
    <span class="token comment">// æ‰€ä»¥è¿™é‡Œéœ€è¦å…ˆé€’å¢æ ˆé¡¶æŒ‡é’ˆï¼Œå†å…¥æ ˆframe</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">call</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token operator">*</span><span class="token punctuation">(</span><span class="token operator">++</span>top<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token punctuation">(</span>Frame<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">.</span>pc <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> __VA_ARGS__<span class="token punctuation">}</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span>
    
    <span class="token comment">// Function return: pop the top-most frame</span>
    <span class="token comment">// ä»å‡½æ•°ä¸­è¿”å›ç›¸å½“äºå‡ºæ ˆã€€valä¸­æ˜¯è¿”å›å€¼</span>
    <span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">ret</span><span class="token expression"><span class="token punctuation">(</span>val<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> top<span class="token operator">--</span><span class="token punctuation">;</span> retval <span class="token operator">=</span> <span class="token punctuation">(</span>val<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span></span>
</pre></div></code-block></li><li id="fVvCFGPHgCJp2E1mVd3VqY"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">å®šä¹‰å‡½æ•°è¿”å›å€¼ä»¥åŠåˆå§‹åŒ–æ ˆ</span><code-block id="qJb6UDJA4z7KpTqFJKNYqs" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>    <span class="token comment">// The last function-return's value. It is not obvious</span>
    <span class="token comment">// that we only need one retval.</span>
    <span class="token keyword">int</span> retval <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>

    <span class="token comment">// The initial call to the recursive function</span>
    <span class="token function">call</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">)</span><span class="token punctuation">;</span>
</pre></div></code-block></li><li id="dwuZ23xEF4aUcdrSSspAVF"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">çŠ¶æ€æ›´è¿­</span><div id="6D1t2QZWuiRE1ssQRXB6KW" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u><b>æ¯æ¬¡å–æ ˆé¡¶çš„æ ˆå¸§<span class="jill"></span>PC</b></u></span><span class="green inline-wrap"><u>æ‰§è¡Œï¼Œæ ¹æ®<span class="jill"></span>PC<span class="jill"></span>æ‰€åœ¨çš„ä½ç½®ï¼Œå†³å®šå®ƒæ˜¯è¦<span class="jill"></span>call<span class="jill"></span>è¿˜æ˜¯èµ‹å€¼ä¸­é—´å˜é‡è¿˜æ˜¯è¿”å›ã€‚æ‰§è¡Œå®Œåï¼Œé€’å¢<span class="jill"></span>PC</u></span></div></div><code-block id="2gFacrfEqGR2NoyxXrjuFS" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre>   <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Fetch the top-most frame.</span>
        <span class="token comment">// è·å–æ ˆé¡¶æŒ‡é’ˆ</span>
        Frame <span class="token operator">*</span>f <span class="token operator">=</span> top<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>f <span class="token operator">&lt;</span> stk<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//æ ˆç©º</span>
            <span class="token comment">// No top-most frame any more; we're done.</span>
            <span class="token keyword">break</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token comment">// Jumps may change this default next pc.</span>
        <span class="token keyword">int</span> next_pc <span class="token operator">=</span> f<span class="token operator">-></span>pc <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>

        <span class="token comment">// Single step execution.</span>

        <span class="token comment">// Extract the parameters from the current frame. (It's</span>
        <span class="token comment">// generally a bad idea to reuse variable names in</span>
        <span class="token comment">// practice; but we did it here for readability.)</span>
        <span class="token comment">// ä»æ ˆå¸§ä¸­è·å¾—å‚æ•°</span>
        <span class="token keyword">int</span> n <span class="token operator">=</span> f<span class="token operator">-></span>n<span class="token punctuation">,</span> from <span class="token operator">=</span> f<span class="token operator">-></span>from<span class="token punctuation">,</span> to <span class="token operator">=</span> f<span class="token operator">-></span>to<span class="token punctuation">,</span> via <span class="token operator">=</span> f<span class="token operator">-></span>via<span class="token punctuation">;</span>

        <span class="token comment">// åŸºæœ¬ä¸Šæ˜¯æŒ‰ç…§é€’å½’çš„æ±‰è¯ºå¡”å‡½æ•°å†…éƒ¨å®ç°</span>
        <span class="token keyword">switch</span> <span class="token punctuation">(</span>f<span class="token operator">-></span>pc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">case</span> <span class="token number">0</span><span class="token operator">:</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">"%c -> %c\n"</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">ret</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
               ã€€ <span class="token punctuation">}</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">1</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> via<span class="token punctuation">,</span> to<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">2</span><span class="token operator">:</span> f<span class="token operator">-></span>c1 <span class="token operator">=</span> retval<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">3</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> from<span class="token punctuation">,</span> to<span class="token punctuation">,</span> via<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">4</span><span class="token operator">:</span> <span class="token function">call</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">,</span> via<span class="token punctuation">,</span> to<span class="token punctuation">,</span> from<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">5</span><span class="token operator">:</span> f<span class="token operator">-></span>c2 <span class="token operator">=</span> retval<span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">case</span> <span class="token number">6</span><span class="token operator">:</span> <span class="token function">ret</span><span class="token punctuation">(</span>f<span class="token operator">-></span>c1 <span class="token operator">+</span> f<span class="token operator">-></span>c2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token keyword">default</span><span class="token operator">:</span> <span class="token function">assert</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        f<span class="token operator">-></span>pc <span class="token operator">=</span> next_pc<span class="token punctuation">;</span> <span class="token comment">//å†™PC</span>
    <span class="token punctuation">}</span>
</pre></div></code-block></li><li id="qjSK11wKsFkxJ2A6PRkN9t"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">æœ€åè¿”å›æœ€ç»ˆçš„è¿”å›å€¼</span><div id="aENVGWWHKWGCrFJoooTh3C" class="wolai-block wolai-text"><div><span class="inline-wrap"><code>return retval</code></span></div></div></li></ul></li></ul></div><aside id="7uTEQ6DavqRpVirgmvxdAr" class="bg-cultured wolai-block"><div data-symbol="ğŸ–ï¸" class="icon"></div><span class="yellow inline-wrap"><b>C/C++<span class="jill"></span>ä¸­çš„å‡½æ•°å’Œæ•°å­¦ä¸­çš„å‡½æ•°çš„åŒºåˆ«</b></span><div id="44o1JPSMCYb3CEyyt89F7E" class="wolai-block wolai-text"><div><span class="inline-wrap">ä¾‹å¦‚ï¼Œå¯ä»¥æŠŠ<span class="jill"></span>Fibonacci æ•°åˆ—çš„é€’å½’å…¬å¼å†™æˆä¸‹å¼ï¼Œä½†æ˜¯æ±‰è¯ºå¡”ä¸è¡Œ</span></div></div><code-block id="bLTQXpBrFPn94mYu5PCQHn" class="wolai-block"><div class="wolai-pre"><div data-lang="C++" class="marker"></div><pre><span class="token comment">// ä¹Ÿå¯ä»¥ return f(n - 2) + f(n - 1)</span>
<span class="token punctuation">;</span><span class="token keyword control-flow">return</span> <span class="token function">f</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">f</span><span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></div></code-block><div id="88VDqZXAR9rf72LPpkYcVc" class="wolai-block wolai-text"><div><span class="green inline-wrap"><u>ä¸è¡Œçš„æ ¹æœ¬åŸå› åœ¨äº</u></span><span class="green inline-wrap"><u><b>æ±‰è¯ºå¡”ä¸­çš„ printf ä¼šå¸¦æ¥å…¨å±€çš„å‰¯ä½œç”¨ï¼Œéœ€è¦æŒ‰ç…§é¡ºåºè¾“å‡ºã€‚</b></u></span><span class="green inline-wrap"><u> C/C++ éµå¾ª â€œé¡ºåºæ‰§è¡Œâ€ çš„åŸåˆ™ï¼Œå‡½æ•°çš„æ‰§è¡Œæœ‰ â€œå…ˆåâ€ ï¼ˆä¸åƒæ•°å­¦çš„å‡½æ•°ï¼Œå…ˆåæ˜¯æ— å…³çš„ï¼‰ï¼Œ</u></span><span class="green inline-wrap"><u><b>æŒ‰ç…§ä¸åŒé¡ºåºè°ƒç”¨ä¼šå¯¼è‡´ç¨‹åºè¾“å‡ºä¸åŒçš„ç»“æœ</b></u></span><span class="green inline-wrap"><u>ã€‚è€Œåœ¨å…·ä½“å®ç°æ—¶ï¼Œæ¯ä¸ªæ ˆå¸§ä¸­å­˜æ”¾çš„ â€œå½“å‰æ‰§è¡Œçš„ä½ç½®â€ ï¼ˆPCï¼‰ å®ç°äº†é¡ºåºæ‰§è¡Œ</u></span></div></div></aside><h2 id="9iTAjx83CcKmfiewVbgx3j" class="wolai-block"><span class="inline-wrap">ç¼–è¯‘å™¨ä¸ç¼–è¯‘ä¼˜åŒ–</span></h2><h3 id="Q6EgVnZZESXfw4pgDv9zg" class="wolai-block"><span class="inline-wrap">ç¼–è¯‘å™¨</span></h3><div id="54ayWgXc5566YMcXJCsRYr" class="wolai-block wolai-text"><div><span class="green inline-wrap"><b>ç¼–è¯‘çš„è¿‡ç¨‹å®é™…ä¸Šæ˜¯æŠŠâ€œC<span class="jill"></span>è¯­è¨€çš„çŠ¶æ€æœºâ€ç¿»è¯‘æˆâ€œæ±‡ç¼–è¯­è¨€çš„çŠ¶æ€æœºâ€ï¼Œä¹Ÿå°±æ˜¯è¯´ç¼–è¯‘å™¨å®é™…ä¸Šæ˜¯çŠ¶æ€æœºä¹‹å‰çš„ç¿»è¯‘å™¨</b></span></div></div><div id="7e4ZCe2R8j6iB2MQBgCsVN" class="wolai-block wolai-text"><div><span class="inline-wrap">ä»¥<span class="jill"></span>Simple C<span class="jill"></span>æ¥è¯´ï¼Œå®ƒçš„ç¼–è¯‘æ¶‰åŠåˆ°ä¸€ä¸‹ä¸‰ä¸ªæ–¹é¢ï¼š</span></div><ul class="wolai-block"><li id="7nVd9Sp536D716HaSFZ2Kq"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">è¿ç®—ï¼šæ“ä½œæ•°<span class="jill"></span>load<span class="jill"></span>åˆ°å¯„å­˜å™¨ã€ç„¶åä½¿ç”¨å¯¹åº”çš„æ“ä½œç¬¦è¿›è¡Œè¿ç®—ï¼Œæœ€å<span class="jill"></span>Store<span class="jill"></span>åˆ°å†…å­˜ä¸­</span></li><li id="bMLgb7KZh1fdyYBWN4Af2a"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">åˆ†æ”¯ï¼šæ¡ä»¶è½¬ç§»æŒ‡ä»¤</span></li><li id="mc4qQQtoVgAag14STr3WUd"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="inline-wrap">å‡½æ•°è°ƒç”¨ï¼šä½¿ç”¨</span><span class="inline-wrap"><code>æ ˆå¸§å¯„å­˜å™¨<span class="jill"></span>stackpoint</code></span><span class="inline-wrap">ï¼Œè¯»å–å†…å­˜ä¸­çš„æ ˆå¸§</span></li></ul></div><div class="block-ref"><div class="decorator"></div><div id="xbWCaKVEWLVfjRhmBusrNM" class="wolai-sub-page wolai-block"><div class="page-icon"></div><a href="https://www.wolai.com/xbWCaKVEWLVfjRhmBusrNM"><span>My_C_Compiler</span></a></div></div><blockquote id="fpnHXuzNKid3YYhwVHfpZW" class="wolai-block"><span class="green inline-wrap"><u>ç”±äº<span class="jill"></span>Simple C<span class="jill"></span>è¿™ç§ç›´æ¥ç¿»è¯‘çš„æ€§è´¨ï¼Œå°†<span class="jill"></span>C<span class="jill"></span>è¯­è¨€åˆç§°ä¹‹ä¸ºâ€œé«˜çº§æ±‡ç¼–è¯­è¨€â€â€”â€”å­˜åœ¨<span class="jill"></span>C<span class="jill"></span>ä»£ç åˆ°æŒ‡ä»¤é›†çš„ç›´æ¥å¯¹åº”å…³ç³»ï¼ŒçŠ¶æ€æœºå’Œè¿ç§»éƒ½å¯ä»¥â€œç›´è¯‘â€</u></span></blockquote><h3 id="wv3XcPya676qu9vY6EGSPj" class="wolai-block"><span class="inline-wrap">ç¼–è¯‘ä¼˜åŒ–</span></h3><div id="kQDQSYpqNn4H1mVM1qxDyx" class="wolai-block wolai-text"><div><span class="inline-wrap">C è¯­è¨€ç¼–è¯‘å™¨åœ¨è¿›è¡Œä»£ç ä¼˜åŒ–æ—¶ï¼Œ</span><span class="green inline-wrap"><b>éµå¾ªçš„åŸºæœ¬å‡†åˆ™æ˜¯åœ¨ä¸æ”¹å˜ç¨‹åºçš„è¯­ä¹‰ï¼ˆå³ç¨‹åºçš„è¡Œä¸ºå’Œè¾“å‡ºç»“æœï¼‰çš„å‰æä¸‹ï¼Œæé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡å’Œ/æˆ–å‡å°‘ç¨‹åºçš„èµ„æºæ¶ˆè€—</b></span><span class="inline-wrap"></span><span class="inline-wrap">ã€‚å…¶ä¸­ï¼Œæœ€é‡è¦çš„â€œä¸‰æ¿æ–§â€æ˜¯ï¼š</span></div><ul class="wolai-block"><li id="perHMcgSekwM3Fig3eQrwH"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>å‡½æ•°å†…è”ï¼šå°†å‡½æ•°è°ƒç”¨æ›¿æ¢ä¸ºå‡½æ•°ä½“æœ¬èº«çš„å†…å®¹</b></span></li><li id="weUNED8wT8AXLk2H39KCYV"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>å¸¸é‡ä¼ æ’­ï¼šåœ¨ç¼–è¯‘æ—¶è®¡ç®—å¸¸é‡è¡¨è¾¾å¼çš„å€¼å¹¶æ›¿æ¢</b></span></li><li id="5ZaKPw61XoqfL6NiNKasKU"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>æ­»ä»£ç æ¶ˆé™¤ï¼šåˆ é™¤æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œåˆ°çš„ä»£ç </b></span></li></ul></div><div id="k3LHcRSiZBK7SKNTmPAkCN" class="wolai-block wolai-text"><div><span class="inline-wrap">è€Œç¼–è¯‘å™¨ä¸€èˆ¬ä¸ä¼˜åŒ–çš„éƒ¨åˆ†åŒ…æ‹¬ï¼š</span></div><ul class="wolai-block"><li id="ii3YqATpiQpv3RBMV1ukPh"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>æœ¬æ‰§è¡Œæ–‡ä»¶å†…çš„ç³»ç»Ÿè°ƒç”¨</b></span></li><li id="fhLHFep3hBBe3hLkX1pcKz"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>å¤–éƒ¨å‡½æ•°è°ƒç”¨ï¼ˆæœªçŸ¥ä»£ç ï¼Œå¯èƒ½å†…éƒ¨å­˜åœ¨ç³»ç»Ÿè°ƒç”¨ï¼‰</b></span></li><li id="91AYNPVL4VW3x34LYfvnVP"><div class="marker"><svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M12 14.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z"></path></svg></div><span class="blue inline-wrap"><b>ç¼–è¯‘å™¨æä¾›çš„ä¸å¯ä¼˜åŒ–æ ‡æ³¨ï¼švolatileã€æœ‰å‡½æ•°é—´éš”çš„<span class="jill"></span>loadã€store<span class="jill"></span>ä»¥åŠ<span class="jill"></span>inline assembly</b></span></li></ul></div><blockquote id="vD8KhkRpneS7dyTSMxB2J2" class="wolai-block"><span class="yellow inline-wrap"><b>ä½†æ˜¯è¿™æ ·çš„ç¼–è¯‘å™¨ä¼˜åŒ–åŸåˆ™æ˜¯æœ‰ç‚¹ä¿å®ˆçš„</b></span><div id="6mZFNL9up3mwmbAt5M8g4t" class="wolai-block wolai-text"><div><span class="inline-wrap">ä¾‹å¦‚ï¼Œä¸‹é¢çš„ä»£ç ï¼Œç¼–è¯‘å™¨ä¸å¥½å°†å…¶åˆå¹¶ä¸ºä¸€ä¸ª<span class="jill"></span>printfï¼Œé€šè¿‡<span class="jill"></span>write<span class="jill"></span>ç³»ç»Ÿè°ƒç”¨å†™å…¨éƒ¨å­—ç¬¦</span></div></div><code-block id="sTkbrUHbDcLYHVXqeEAcBY" class="wolai-block"><div class="wolai-pre"><div data-lang="C" class="marker"></div><pre><span class="token keyword">if</span> <span class="token punctuation">(</span>n <span class="token operator">&lt;=</span> <span class="token number">26</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">putchar</span><span class="token punctuation">(</span><span class="token char">'A'</span> <span class="token operator">+</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span></pre></div></code-block><div id="45LoMfUnKu6oZKxd5fj78Z" class="wolai-block wolai-text"><div><span class="blue inline-wrap"><b>å› æ­¤ï¼Œåœ¨ç°åœ¨çš„æ“ä½œç³»ç»Ÿä¸­å­˜åœ¨ç€ä¸€ç§æ–°çš„æ–¹å‘ï¼šå°†çŠ¶æ€æœºçš„ä¸€éƒ¨åˆ†ç›´æ¥æ”¾åœ¨æ“ä½œç³»ç»Ÿä¸­è¿è¡Œ</b></span></div></div><ol class="wolai-block"><li id="ppVSaFMNsZoe8JBxqPUKCw" class="green"><div class="marker"></div><span class="inline-wrap">æŠŠä»£ç æ”¾è¿›æ“ä½œç³»ç»Ÿä¸­æ‰§è¡Œï¼šXRP</span></li><li id="9rSW8WWECF98nBJMCbTLBz" class="green"><div class="marker"></div><span class="inline-wrap">å•ä¸ªåº”ç”¨å°±æ˜¯ä¸€ä¸ªæ“ä½œç³»ç»Ÿï¼šUnikernel</span></li></ol></blockquote><div id="x2R9GjrC4GJWvxVzGuzdCX" class="wolai-block wolai-text"><div></div></div></article><footer></footer></body></html>